<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>화성시 현황카드 검색</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.css@8/themes/satellite-min.css">
    <script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .ais-SearchBox {
            margin-bottom: 30px;
        }
        .ais-SearchBox-input {
            padding: 12px;
            font-size: 16px;
        }
        .ais-Hits-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        .card-number {
            font-weight: bold;
            color: #0066cc;
        }
        .card-category {
            background: #e3f2fd;
            padding: 4px 8px;
            border-radius: 4px;
            color: #1976d2;
        }
        .card-content {
            line-height: 1.6;
        }
        .card-content p {
            margin: 8px 0;
        }
        .label {
            font-weight: bold;
            color: #666;
        }
        .ais-Stats {
            text-align: right;
            margin-bottom: 20px;
            color: #666;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🏛️ 화성시 현황카드 검색 시스템</h1>
        
        <div id="searchbox"></div>
        <div id="stats"></div>
        <div id="hits"></div>
        <div id="pagination"></div>
    </div>

    <script>
        const searchClient = algoliasearch(
            'X02D3JQ3LS',
            '66df50144b6ff51f5e49324905c350ae'
        );

        const search = instantsearch({
            indexName: 'hwaseong',  // 새로 만든 인덱스
            searchClient,
        });

        search.addWidgets([
            instantsearch.widgets.searchBox({
                container: '#searchbox',
                placeholder: '검색어 입력 (예: 김상균, 동탄, 복지, 도로)',
                cssClasses: {
                    input: 'form-control',
                }
            }),
            
            instantsearch.widgets.stats({
                container: '#stats',
                templates: {
                    text: `
                        {{#hasNoResults}}검색 결과가 없습니다{{/hasNoResults}}
                        {{#hasOneResult}}1개 항목 발견{{/hasOneResult}}
                        {{#hasManyResults}}총 {{#helpers.formatNumber}}{{nbHits}}{{/helpers.formatNumber}}개 항목 발견 ({{processingTimeMS}}ms){{/hasManyResults}}
                    `,
                },
            }),
            
            instantsearch.widgets.hits({
                container: '#hits',
                templates: {
                    item(hit) {
                        // 데이터 필드 안전하게 가져오기
                        const cardNumber = hit.카드번호 || hit['카드번호'] || '-';
                        const category = hit.분류 || hit['분류'] || '-';
                        const region = hit.지역 || hit['지역'] || '-';
                        const title = hit.현안제목 || hit['현안제목'] || '-';
                        const problem = hit.문제점 || hit['문제점'] || '-';
                        const suggestion = hit.제안내용 || hit['제안내용'] || '-';
                        const department = hit.담당부서 || hit['담당부서'] || '-';
                        
                        return `
                            <div class="card-header">
                                <span class="card-number">${cardNumber}</span>
                                <span class="card-category">${category}</span>
                            </div>
                            <div class="card-content">
                                <p><span class="label">지역:</span> ${region}</p>
                                <p><span class="label">현안제목:</span> ${title}</p>
                                <p><span class="label">문제점:</span> ${problem}</p>
                                <p><span class="label">제안내용:</span> ${suggestion}</p>
                                <p><span class="label">담당부서:</span> ${department}</p>
                            </div>
                        `;
                    },
                    empty: `
                        <div class="no-results">
                            <p>검색 결과가 없습니다.</p>
                            <p>다른 검색어를 시도해보세요.</p>
                        </div>
                    `,
                },
            }),
            
            instantsearch.widgets.pagination({
                container: '#pagination',
                cssClasses: {
                    list: 'pagination',
                    item: 'page-item',
                    link: 'page-link',
                }
            }),
        ]);

        search.start();
    </script>
</body>
</html>
